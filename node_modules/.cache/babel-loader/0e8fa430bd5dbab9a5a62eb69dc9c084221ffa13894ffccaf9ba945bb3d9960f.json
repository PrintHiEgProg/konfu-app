{"ast":null,"code":"var _jsxFileName = \"/Users/egorkobzev/conference-app/src/WebFeed.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport socketIO from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction WebcamFeed() {\n  _s();\n  const [stream, setStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const videoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const socket = socketIO.connect(\"https://printhiegprog-knofu-app-backend-46b9.twc1.net\");\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      setStream(stream);\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    }).catch(error => {\n      console.error(\"Error accessing webcam:\", error);\n    });\n  }, []);\n  useEffect(() => {\n    // Создаем peer connection\n    const pc = new RTCPeerConnection();\n\n    // Добавляем локальный поток к peer connection\n    stream.getTracks().forEach(track => {\n      pc.addTrack(track, stream);\n    });\n\n    // Создаем offer и отправляем его на сервер\n    pc.createOffer().then(offer => {\n      return pc.setLocalDescription(new RTCSessionDescription({\n        type: \"offer\",\n        sdp: offer\n      }));\n    }).then(() => {\n      // Отправляем offer на сервер\n      fetch(\"https://printhiegprog-knofu-app-backend-46b9.twc1.net/offer\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(pc.localDescription)\n      });\n    });\n\n    // Обрабатываем ответ от сервера\n    fetch(\"/answer\").then(response => {\n      return response.json();\n    }).then(answer => {\n      // Устанавливаем ответ от сервера\n      pc.setRemoteDescription(new RTCSessionDescription({\n        type: \"answer\",\n        sdp: answer\n      }));\n    });\n\n    // Обрабатываем добавление удаленного потока\n    pc.onaddstream = event => {\n      setRemoteStream(event.stream);\n      if (remoteVideoRef.current) {\n        remoteVideoRef.current.srcObject = event.stream;\n      }\n    };\n  }, [stream]);\n  const TypeUserAdmin = () => {\n    setRemoteStream(false);\n    setStream(true);\n  };\n  const TypeUserMember = () => {\n    setStream(false);\n    setRemoteStream(true);\n  };\n  useEffect(() => {\n    if (stream) {\n      // Добавляем локальный поток к peer connection\n      stream.getTracks().forEach(track => {\n        pc.addTrack(track, stream);\n      });\n\n      // Создаем offer и отправляем его на сервер\n      pc.createOffer().then(offer => {\n        return pc.setLocalDescription(new RTCSessionDescription({\n          type: \"offer\",\n          sdp: offer\n        }));\n      }).then(() => {\n        // Отправляем offer на сервер\n        fetch(\"https://printhiegprog-knofu-app-backend-46b9.twc1.net/offer\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify(pc.localDescription)\n        });\n      });\n    }\n  }, [stream]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: TypeUserAdmin,\n      children: \"\\u0421\\u0442\\u0430\\u0442\\u044C \\u0430\\u0434\\u043C\\u0438\\u043D\\u043E\\u043C\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: TypeUserMember,\n      children: \"\\u0421\\u0442\\u0430\\u0442\\u044C \\u0441\\u043B\\u0443\\u0448\\u0430\\u0442\\u0435\\u043B\\u0435\\u043C\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 11\n    }, this), stream && /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      width: \"640\",\n      height: \"480\",\n      autoPlay: true,\n      playsInline: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }, this), remoteStream && /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: remoteVideoRef,\n      width: \"640\",\n      height: \"480\",\n      autoPlay: true,\n      playsInline: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 7\n  }, this);\n}\n_s(WebcamFeed, \"YG+eRiE1HSsFaLmVLhksS8cJL44=\");\n_c = WebcamFeed;\nexport default WebcamFeed;\nvar _c;\n$RefreshReg$(_c, \"WebcamFeed\");","map":{"version":3,"names":["React","useState","useEffect","useRef","socketIO","jsxDEV","_jsxDEV","WebcamFeed","_s","stream","setStream","remoteStream","setRemoteStream","videoRef","remoteVideoRef","socket","connect","navigator","mediaDevices","getUserMedia","video","audio","then","current","srcObject","catch","error","console","pc","RTCPeerConnection","getTracks","forEach","track","addTrack","createOffer","offer","setLocalDescription","RTCSessionDescription","type","sdp","fetch","method","headers","body","JSON","stringify","localDescription","response","json","answer","setRemoteDescription","onaddstream","event","TypeUserAdmin","TypeUserMember","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","ref","width","height","autoPlay","playsInline","_c","$RefreshReg$"],"sources":["/Users/egorkobzev/conference-app/src/WebFeed.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport socketIO from \"socket.io-client\";\n\nfunction WebcamFeed() {\n  const [stream, setStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const videoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n\n    \n    const socket = socketIO.connect(\n      \"https://printhiegprog-knofu-app-backend-46b9.twc1.net\"\n    );\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        setStream(stream);\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n        }\n      })\n      .catch((error) => {\n        console.error(\"Error accessing webcam:\", error);\n      });\n  }, []);\n\n  useEffect(() => {\n    // Создаем peer connection\n    const pc = new RTCPeerConnection();\n\n    // Добавляем локальный поток к peer connection\n    stream.getTracks().forEach((track) => {\n      pc.addTrack(track, stream);\n    });\n\n    // Создаем offer и отправляем его на сервер\n    pc.createOffer()\n      .then((offer) => {\n        return pc.setLocalDescription(\n          new RTCSessionDescription({ type: \"offer\", sdp: offer })\n        );\n      })\n      .then(() => {\n        // Отправляем offer на сервер\n        fetch(\"https://printhiegprog-knofu-app-backend-46b9.twc1.net/offer\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(pc.localDescription),\n        });\n      });\n\n    // Обрабатываем ответ от сервера\n    fetch(\"/answer\")\n      .then((response) => {\n        return response.json();\n      })\n      .then((answer) => {\n        // Устанавливаем ответ от сервера\n        pc.setRemoteDescription(\n          new RTCSessionDescription({ type: \"answer\", sdp: answer })\n        );\n      });\n\n    // Обрабатываем добавление удаленного потока\n    pc.onaddstream = (event) => {\n      setRemoteStream(event.stream);\n      if (remoteVideoRef.current) {\n        remoteVideoRef.current.srcObject = event.stream;\n      }\n    };\n  }, [stream]);\n\n    const TypeUserAdmin = () => {\n        setRemoteStream(false)\n        setStream(true)\n    }\n\n    const TypeUserMember = () => {\n        setStream(false)\n        setRemoteStream(true)\n    }\n\nuseEffect(() => {\n  if (stream) {\n    // Добавляем локальный поток к peer connection\n    stream.getTracks().forEach((track) => {\n      pc.addTrack(track, stream);\n    });\n\n    // Создаем offer и отправляем его на сервер\n    pc.createOffer()\n      .then((offer) => {\n        return pc.setLocalDescription(\n          new RTCSessionDescription({ type: \"offer\", sdp: offer })\n        );\n      })\n      .then(() => {\n        // Отправляем offer на сервер\n        fetch(\"https://printhiegprog-knofu-app-backend-46b9.twc1.net/offer\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(pc.localDescription),\n        });\n      });\n  }\n}, [stream]);\n  return (\n      <div>\n          <button onClick={TypeUserAdmin}>Стать админом</button>\n          <button onClick={TypeUserMember}>Стать слушателем</button>\n      {stream && (\n        <video ref={videoRef} width=\"640\" height=\"480\" autoPlay playsInline />\n      )}\n      {remoteStream && (\n        <video\n          ref={remoteVideoRef}\n          width=\"640\"\n          height=\"480\"\n          autoPlay\n          playsInline\n        />\n      )}\n    </div>\n  );\n}\n\nexport default WebcamFeed;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}